<!doctype html><html lang=en-us><head><title>Using Cloudflare as a Dynamic DNS (DDNS) provider | Daniel Brennand</title><meta charset=utf-8><meta name=language content="en"><meta name=description content="How to use Cloudflare as a DDNS provider."><meta name=keywords content><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><link rel="shortcut icon" type=image/png href=/favicon.ico><link type=text/css rel=stylesheet href=/css/post.min.2cb93c91050d1853bf971cc31e00122edd6e0f405aa1de3b7f8ef67ea3b5a79a.css integrity="sha256-LLk8kQUNGFO/lxzDHgASLt1uD0Baod47f472fqO1p5o="><link type=text/css rel=stylesheet href=/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css integrity="sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU="><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/danielbrennand.com\/"},"articleSection":"blog","name":"Using Cloudflare as a Dynamic DNS (DDNS) provider","headline":"Using Cloudflare as a Dynamic DNS (DDNS) provider","description":"How to use Cloudflare as a DDNS provider.","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2020","datePublished":"2020-07-26 17:46:07 \u002b0100 \u002b0100","dateModified":"2020-07-26 17:46:07 \u002b0100 \u002b0100","url":"https:\/\/danielbrennand.com\/blog\/cloudflare-ddns\/","wordCount":"915","keywords":["Blog"]}</script></head><body><div class=burger__container><div class=burger aria-controls=navigation aria-label=Menu><div class="burger__meat burger__meat--1"></div><div class="burger__meat burger__meat--2"></div><div class="burger__meat burger__meat--3"></div></div></div><nav class=nav id=navigation><ul class=nav__list><li><a href=/>About</a></li><li><a href=/blog>Blog</a></li></ul></nav><main><div class=flex-wrapper><div class=post__container><div class=post><header class=post__header><h1 id=post__title>Using Cloudflare as a Dynamic DNS (DDNS) provider</h1><time datetime="2020-07-26 17:46:07 +0100 +0100" class=post__date>Jul 26 2020</time></header><article class=post__content><p>This blog post will show you how to use Cloudflare as a Dynamic DNS (DDNS) provider.</p><h2 id=what-is-ddns>What is DDNS?<a class=anchor href=#what-is-ddns>#</a></h2><blockquote><p>Dynamic DNS (DDNS) is a service that keeps the Domain Name System (DNS) updated with a web property‚Äôs correct IP address.
<cite>Cloudflare glossary: Dynamic DNS <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></cite></p></blockquote><p>Essentially, DDNS allows you to automatically update your DNS records when a change is detected to your public IP address.</p><h2 id=ddns-common-use-case>DDNS Common Use Case<a class=anchor href=#ddns-common-use-case>#</a></h2><p>Many Internet Service Providers (ISPs) do not provide their customers with a static public IP address. This can cause issues for people who self-host applications from home and have DNS records pointing to their ISP provided public IP address.</p><p>Say you are hosting some applications from home and have DNS records pointing to your home&rsquo;s public IP address. What if you router suddenly rebooted due to a software or hardware issue?</p><p>Your ISP <strong>may</strong> assign you with a new public IP address causing your applications to be inaccessible. This is an example of where DDNS could help.</p><p>With DDNS, you can ensure your DNS records are automatically kept up to date when your home&rsquo;s public IP address changes üëç</p><h2 id=other-ddns-providers>Other DDNS providers<a class=anchor href=#other-ddns-providers>#</a></h2><p>Cloudflare is not the only option for DDNS. There are many others including:</p><ul><li><p><a href=https://www.duckdns.org/>DuckDNS</a></p></li><li><p><a href=https://www.noip.com/>NoIP</a></p></li><li><p><a href=https://freedns.afraid.org/>FreeDNS</a></p></li></ul><p>However, for this blog post, we are obviously focusing on using Cloudflare üòÑ</p><h2 id=using-cloudflare-as-a-ddns-provider>Using Cloudflare as a DDNS provider<a class=anchor href=#using-cloudflare-as-a-ddns-provider>#</a></h2><p>We will be using the <a href=https://github.com/oznu/docker-cloudflare-ddns>docker-cloudflare-ddns</a> docker container created by <a href=https://github.com/oznu>oznu</a> to use Cloudflare as a DDNS provider.</p><h3 id=prerequisites>Prerequisites<a class=anchor href=#prerequisites>#</a></h3><ol><li><p>A domain managed with Cloudflare.</p></li><li><p>Docker installed on a server which can reach the Cloudflare API: <code>https://api.cloudflare.com/client/v4/</code>.</p></li><li><p>A Cloudflare API token (see below).</p></li></ol><h4 id=creating-a-cloudflare-api-token>Creating a Cloudflare API Token</h4><p>To obtain a Cloudflare API token:</p><ol><li><p>Log in to the <a href=https://dash.cloudflare.com/profile/api-tokens>Cloudflare dashboard</a> to manage your API tokens.</p></li><li><p>Click <strong>Create Token</strong>.</p></li><li><p>Under <em>Custom Token</em>, click <strong>Get started</strong>.</p></li><li><p>Provide a <em>Name</em> for the API token.</p></li><li><p>Under <em>Permissions</em>, grant the following to the API token:</p><ul><li><p>Zone / Zone Settings / Read</p></li><li><p>Zone / Zone / Read</p></li><li><p>Zone / DNS / Edit</p></li></ul><p><img src=/images/api-token-permissions.png alt="Cloudflare API token permissions"></p></li><li><p>Under <em>Zone Resources</em>, include the zone (domain) you want to grant the API token permissions to edit.</p></li></ol><p><img src=/images/full-api-token.png alt="Cloudflare API token summary"></p><ol start=7><li><p>Click <strong>Continue to summary</strong>.</p></li><li><p>Review the API token configuration and click <strong>Create Token</strong>.</p></li></ol><h3 id=using-the-docker-cloudflare-ddns-container>Using the docker-cloudflare-ddns container<a class=anchor href=#using-the-docker-cloudflare-ddns-container>#</a></h3><p>The docker-cloudflare-ddns container <strong>requires</strong> the following environment variables:</p><ul><li><p><code>API_KEY</code>: The API token (created above) used to update a DNS record for the granted zone.</p></li><li><p><code>ZONE</code>: The DNS zone which updates should be applied to.</p><ul><li>Example: <code>danielbrennand.com</code>.</li></ul></li></ul><p>Notable optional environment variables:</p><ul><li><p><code>SUBDOMAIN</code>: The subdomain in the <code>ZONE</code> to update a DNS record for.</p><ul><li><strong>NOTE</strong>: If absent, the root zone (Example: <code>danielbrennand.com</code>) DNS record will be updated.</li></ul></li><li><p><code>PROXIED</code>: If <code>true</code>, the proxy status on the DNS record will be set to proxy traffic through Cloudflare.</p></li><li><p><code>RRTYPE</code>: Defaults to: <code>A</code> for IPv4. To use IPv6, you can alter the value to <code>AAAA</code>.</p><ul><li><strong>NOTE</strong>: To use IPv6 (<code>AAAA</code>), Docker must have <a href=https://docs.docker.com/config/daemon/ipv6/>IPv6 support</a> enabled.</li></ul></li><li><p><code>CRON</code>: The interval to check if the DNS record needs to be updated. Defaults to: <code>*/5 * * * *</code> (5 minutes).</p><ul><li>For useful cron examples, see <a href=https://crontab.guru/examples.html>here</a>.</li></ul></li></ul><p>Other environment variables can be found <a href=https://github.com/oznu/docker-cloudflare-ddns#optional-parameters>here</a>.</p><p><strong>NOTE</strong>: If the DNS record to be updated does not exist, it will be created automatically.</p><h4 id=deployment-examples>Deployment Examples</h4><p>I will be using my domain in the examples below. Make sure you alter it to your domain! üòÜ</p><h5 id=example-1>Example 1:</h5><p>Update the DNS record for the subdomain <code>freshrss</code> in the zone <code>danielbrennand.com</code> with traffic proxied through Cloudflare.</p><pre><code class=language-bash>docker run -d --name cloudflare \
  -e API_KEY=&quot;Insert your Cloudflare API token here.&quot; \
  -e ZONE=&quot;danielbrennand.com&quot; \
  -e SUBDOMAIN=&quot;freshrss&quot; \
  -e PROXIED=&quot;true&quot; \
  oznu/cloudflare-ddns
</code></pre><h5 id=example-2>Example 2:</h5><p>Update the DNS record for the root zone <code>danielbrennand.com</code>.</p><pre><code class=language-bash>docker run -d --name cloudflare \
  -e API_KEY=&quot;Insert your Cloudflare API token here.&quot; \
  -e ZONE=&quot;danielbrennand.com&quot; \
  oznu/cloudflare-ddns
</code></pre><h5 id=example-3>Example 3:</h5><p>Update the DNS record with the public IPv6 address for the subdomain <code>freshrss</code> in the zone <code>danielbrennand.com</code> with traffic proxied through Cloudflare.</p><p><strong>NOTE</strong>: Remember, for this example to work, you must have <a href=https://docs.docker.com/config/daemon/ipv6/>IPv6 support</a> enabled in Docker.</p><pre><code class=language-bash>docker run -d --name cloudflare \
  -e API_KEY=&quot;Insert your Cloudflare API token here.&quot; \
  -e ZONE=&quot;danielbrennand.com&quot; \
  -e SUBDOMAIN=&quot;freshrss&quot; \
  -e RRTYPE=&quot;AAAA&quot; \
  -e PROXIED=&quot;true&quot; \
  oznu/cloudflare-ddns
</code></pre><h5 id=example-4>Example 4:</h5><p>Update the DNS record for the subdomain <code>freshrss</code> in the zone <code>danielbrennand.com</code> on an interval of 1 hour.</p><pre><code class=language-bash>docker run -d --name cloudflare \
  -e API_KEY=&quot;Insert your Cloudflare API token here.&quot; \
  -e ZONE=&quot;danielbrennand.com&quot; \
  -e SUBDOMAIN=&quot;freshrss&quot; \
  -e CRON=&quot;0 * * * *&quot; \
  oznu/cloudflare-ddns
</code></pre><p>If successful, observing the container logs using <code>docker logs cloudflare</code> will look similar to the following output:</p><p>The following logs are from Example 1.</p><pre><code>[cont-init.d] executing container initialization scripts...
[cont-init.d] 30-cloudflare-setup: executing...
DNS Zone: danielbrennand.com (619du4059a9354492r54e6702834ao62)
DNS record for 'freshrss.danielbrennand.com' was not found in danielbrennand.com zone. Creating now...
DNS Record: freshrss.danielbrennand.com (bde8a4987aj8ede16d62d7479d967f3l)
[cont-init.d] 30-cloudflare-setup: exited 0.
[cont-init.d] 50-ddns: executing...
No DNS update required for freshrss.danielbrennand.com (Public IPv4 address here).
</code></pre><h3 id=multiple-subdomains>Multiple Subdomains<a class=anchor href=#multiple-subdomains>#</a></h3><p>Your probably thinking, what if I wanted multiple subdomains pointing to my public IP address. Do I have to run this container for each of them!?</p><p>Nope! üòÑ</p><p>You can create CNAME records pointing to the A record referencing your public IP address.</p><p>Continuing with the example subdomain above (<code>freshrss</code>), if I had a new application which I wanted to host at the subdomain <code>foo.danielbrennand.com</code>. I would create the following CNAME record:</p><ul><li><p><strong>Type</strong>: CNAME</p></li><li><p><strong>Name</strong>: foo</p></li><li><p><strong>Target</strong>: freshrss.@</p></li><li><p><strong>TTL</strong>: Auto</p></li><li><p><strong>Proxy Status</strong>: Proxied</p></li></ul><p>I hope you found this blog post useful in showing you how Cloudflare can be used as a DDNS provider üòÉ Until next time! üëã</p><h2 id=references>References<a class=anchor href=#references>#</a></h2><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p><a href=https://www.cloudflare.com/learning/dns/glossary/dynamic-dns/>https://www.cloudflare.com/learning/dns/glossary/dynamic-dns/</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></article><ul class=tags__list><li class=tag__item><a class=tag__link href=https://danielbrennand.com/tags/ddns/>ddns</a></li><li class=tag__item><a class=tag__link href=https://danielbrennand.com/tags/cloudflare/>cloudflare</a></li><li class=tag__item><a class=tag__link href=https://danielbrennand.com/tags/docker/>docker</a></li><li class=tag__item><a class=tag__link href=https://danielbrennand.com/tags/containers/>containers</a></li></ul><div class=pagination><a class=pagination__item href=https://danielbrennand.com/blog/caddy-cloudflare/><span class=pagination__label>Previous Post</span>
<span class=pagination__title>Using Caddy v2's reverse proxy feature with a domain managed with Cloudflare!</span></a></div><footer class=post__footer><div class=social-icons><a class=social-icons__link title=GitHub href=https://github.com/dbrennand target=_blank rel=noopener><div class=social-icons__icon style=background-image:url(https://danielbrennand.com/svg/github.svg)></div></a><a class=social-icons__link title=Email href=mailto:contact@danielbrennand.com target=_blank rel=noopener><div class=social-icons__icon style=background-image:url(https://danielbrennand.com/svg/email.svg)></div></a><a class=social-icons__link title=LinkedIn href=https://www.linkedin.com/in/daniel-brennand/ target=_blank rel=noopener><div class=social-icons__icon style=background-image:url(https://danielbrennand.com/svg/linkedin.svg)></div></a></div><p>¬© 2020</p></footer></div></div></div></main><script src=/js/index.min.49e4d8a384357d9b445b87371863419937ede9fa77737522ffb633073aebfa44.js integrity="sha256-SeTYo4Q1fZtEW4c3GGNBmTft6fp3c3Ui/7YzBzrr+kQ=" crossorigin=anonymous></script><script src=https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js></script><script src=https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js data-autoloader-path=https://unpkg.com/prismjs@1.20.0/components/></script></body></html>